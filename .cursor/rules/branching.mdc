---
alwaysApply: true
---

# Branch Isolation and Multi-Agent Workflow

## When This Applies
Before making ANY changes to code.

## Critical Requirements

### Before Starting Work
- ✅ **Never work on `main` branch** - Always create feature branch first
- ✅ **Run pre-work check**: `./scripts/pre-work-check.sh` (validates branch, coordination, tools)
- ✅ **Use proper naming**: `feature/<description>`, `fix/<description>`, `refactor/<description>`, `docs/<description>`, `test/<description>`

### Branch Creation
```bash
# Standard branch
git checkout -b feature/<task-description>

# For isolation (recommended for shared files)
./scripts/create-worktree.sh <task-name>
```

### During Work
- ✅ **Commit frequently** (every 15-30 min, WIP commits OK)
- ✅ **Check coordination** before modifying shared files
- ✅ **Run tests** before committing: `./gradlew test`

### After Merge
- ✅ **Run cleanup**: `./scripts/post-merge-cleanup.sh <pr-number>`
- ✅ **Check other work** before deleting branches/worktrees

## Implementation

**Automated helpers:**
- `scripts/pre-work-check.sh` - Validates branch, coordination, discovers rules
- `scripts/create-worktree.sh` - Creates isolated worktree
- `scripts/post-merge-cleanup.sh` - Cleans up after merge
- `scripts/check-agent-coordination.sh` - Checks for file conflicts

**Coordination:**
- Check `docs/development/AGENT_COORDINATION.md` before modifying shared files
- Update coordination doc when work status changes

**Shared files (require coordination):**
- `app/.../ui/screens/LandingScreen.kt`
- `app/.../ElectricSheepApplication.kt`
- `app/.../data/DataModule.kt`
- `app/build.gradle.kts`, `build.gradle.kts`

## Related Rules
- `.cursor/rules/branch-synchronization.mdc` - **CRITICAL**: Branch sync and conflict prevention
- `.cursor/rules/frequent-commits.mdc` - Commit frequency guidelines
- `.cursor/rules/repository-maintenance.mdc` - Cleanup procedures
- `.cursor/rules/cicd.mdc` - CI/CD workflow

## Error Prevention

**STOP and fix if:**
- ❌ On `main` branch → Create feature branch
- ❌ Tests failing → Fix before proceeding
- ❌ Shared file conflict → Check coordination, use worktree
- ❌ Branch name doesn't follow convention → Rename branch

## Examples

**See code examples:**
- Branch creation: `scripts/create-worktree.sh`
- Pre-work validation: `scripts/pre-work-check.sh`
- Cleanup automation: `scripts/post-merge-cleanup.sh`

**See documentation:**
- Multi-agent workflow: `docs/development/MULTI_AGENT_WORKFLOW.md`
- Coordination: `docs/development/AGENT_COORDINATION.md`

---
alwaysApply: true
---

# Metrics Collection - Workflow Integration

## CRITICAL: Automatically Capture All Prompts

**When processing ANY user request:**
1. ✅ **AUTOMATICALLY capture prompt** - Call `./scripts/metrics/capture-prompt-simple.sh` for EVERY user request
2. ✅ **Use simple helper** - `./scripts/metrics/capture-prompt-simple.sh "User's prompt text" --model sonnet`
3. ✅ **Use build/test wrappers** - Auto-capture metrics during builds/tests
4. ✅ **Check session scope** - Periodically check for scope creep

**AUTOMATIC CAPTURE**: Since we're using Supabase (database), data size is not an issue. Capture ALL prompts automatically - no filtering needed.

## Automatic Prompt Capture

**CRITICAL: Capture ALL Prompts Automatically**

Since we're using Supabase (database), data size is not an issue. Capture EVERY user prompt automatically:

**✅ Capture ALL prompts:**
- ✅ Every user request (no filtering)
- ✅ All prompts, regardless of complexity
- ✅ Quick fixes, typo fixes, everything
- ✅ Data stored in Supabase (handles scale)

**Why Automatic:**
- Database handles large volumes efficiently
- No need to filter - capture everything
- Better data for analysis and patterns
- No manual decision needed

## Quick Reference

### Automatic Prompt Capture (For Agents)

**CRITICAL: Call this for EVERY user request:**

```bash
# Automatic capture (recommended - handles session ID automatically)
./scripts/metrics/auto-capture-prompt.sh "User's prompt text" --model sonnet

# Or use simple helper directly
./scripts/metrics/capture-prompt-simple.sh "User's prompt text" --model sonnet

# With task type
./scripts/metrics/auto-capture-prompt.sh "Fix bug" --model haiku --task bug_fix

# Model shortcuts: haiku, sonnet, opus
```

**Note**: `auto-capture-prompt.sh` automatically links to current session if available.

### Unified Helper

```bash
# Capture prompt with agent usage
./scripts/metrics/capture-metrics.sh prompt "Your prompt" --model "anthropic.claude-sonnet-4-5-20250929-v1:0" --task-type "feature_implementation"

# Capture agent usage separately
./scripts/metrics/capture-metrics.sh agent --model "anthropic.claude-3-5-haiku-20241022-v2:0" --input-tokens 1000 --output-tokens 500
```

### Automatic Collection

**Already Automated:**
- ✅ Session tracking (auto-starts in pre-work check)
- ✅ Build metrics (via `gradle-wrapper-build.sh`)
- ✅ Test metrics (via `gradle-wrapper-test.sh`)

**Manual (But Easy):**
- ⚠️ Prompt capture (use simple helper when needed)
- ⚠️ Agent usage (can be captured with prompts)

## Integration Points

### Pre-Work Check
- Auto-starts session tracking
- Reminds about metrics capture
- Shows quick reference

### Build/Test Wrappers
- Auto-capture build metrics
- Auto-capture test metrics
- Use wrappers instead of direct gradle commands

### Session Tracking
- Auto-starts on feature branches
- Tracks scope creep
- Updates during workflow

## Workflow Integration

### Daily Workflow

```bash
# 1. Start work (auto-starts session)
./scripts/pre-work-check.sh

# 2. Capture prompts for significant work
./scripts/metrics/capture-prompt-simple.sh "Implement feature X" --model sonnet

# 3. Build/test (auto-captures metrics)
./scripts/gradle-wrapper-build.sh
./scripts/gradle-wrapper-test.sh

# 4. Check scope creep
./scripts/metrics/capture-metrics.sh session check
```

## Best Practices

### DO ✅
- Capture prompts for significant work
- Use simple helper (`capture-prompt-simple.sh`)
- Use build/test wrappers for auto-metrics
- Check session scope periodically
- Don't overthink it - quick capture is better than perfect capture

### DON'T ❌
- Don't capture every tiny change
- Don't skip capturing significant work
- Don't use direct gradle commands (use wrappers)
- Don't forget to check scope creep

## Related Documentation

- `development-metrics/README.md` - Complete metrics documentation
- `scripts/metrics/README.md` - Quick reference guide
- `docs/development/workflow/METRICS_COLLECTION_SETUP.md` - Setup guide
- `docs/development/workflow/METRICS_WORKFLOW_INTEGRATION.md` - Workflow integration
